import{g as e,l as t}from"./job.a5944401.js";import{s as u,_ as o}from"./index.74f0e013.js";const a={class:"app-container"},l=Vue.createTextVNode("搜索"),n=Vue.createTextVNode("重置"),V=Vue.createTextVNode("删除"),r=Vue.createTextVNode("清空"),i=Vue.createTextVNode("导出"),d=Vue.createTextVNode("关闭"),c=Vue.createTextVNode("详细"),s={class:"dialog-footer"},p=Vue.createTextVNode("关 闭"),_=Vue.defineComponent({name:"JobLog"});var f=o(Object.assign(_,{setup(o){const{proxy:_}=Vue.getCurrentInstance(),{sys_common_status:f,sys_job_group:m,sys_task_is_once:v}=_.useDict("sys_common_status","sys_job_group","sys_task_is_once"),h=Vue.ref([]),b=Vue.ref(!1),w=Vue.ref(""),g=Vue.ref(!0),x=Vue.ref(!0),C=Vue.ref([]),N=Vue.ref(!0),j=Vue.ref(0),k=Vue.ref([]),y=VueRouter.useRoute(),B=Vue.ref(!1),D=Vue.ref(null),T=Vue.ref([]),S=Vue.ref({});Vue.onActivated((()=>{O(),z(B.value)})),Vue.onDeactivated((()=>{clearInterval(_.timer),D.value=null}));const E=Vue.reactive({form:{},queryParams:{page_num:1,page_size:10,is_once:void 0,job_name:void 0,job_group:void 0,status:void 0}}),{queryParams:U,form:R}=Vue.toRefs(E);function L(){var e;g.value=!0,(e=_.addDateRange(U.value,k.value),u({url:"/system/job_log/list",method:"get",params:e})).then((e=>{h.value=e.list,j.value=e.total,g.value=!1}))}function $(){_.$router.back(),_.$tab.closeOpenPage()}function q(){U.value.page_num=1,L()}function F(){k.value=[],_.resetForm("queryRef"),q()}function I(e){C.value=e.map((e=>e.job_log_id)),N.value=!e.length}function P(e){let t=e.job_log_id?[e.job_log_id]:C.value;_.$modal.confirm('是否确认删除调度日志编号为"'+t+'"的数据项?').then((function(){return function(e){return u({url:"/system/job_log/delete",method:"delete",data:e})}({job_log_ids:t})})).then((()=>{L(),_.$modal.msgSuccess("删除成功")})).catch((()=>{}))}function Y(){let e=w.value;_.$modal.confirm("是否确认清空当前任务调度日志数据项?").then((function(){return function(e){return u({url:"/system/job_log/clean",method:"delete",data:e})}({job_id:e})})).then((()=>{L(),_.$modal.msgSuccess("清空成功")})).catch((()=>{}))}function z(e){e?_.timer=setInterval((()=>{setTimeout(L,0)}),5e3):(clearInterval(_.timer),D.value=null)}function A(){_.download("monitor/jobLog/export",{...U.value},`job_log_${(new Date).getTime()}.xlsx`)}function M(e){""==e?U.value.job_name=void 0:(T.value=S.value[e],U.value.job_name=T.value[0].job_name),L()}function O(){const t=y.query.job_id;"all"!==t?e({job_id:t}).then((e=>{w.value=t,U.value.job_name=e.job_name,U.value.job_group=e.job_group,U.value.is_once=void 0,L()})):L()}return O(),async function(){const e=await async function(){const e={page_num:1,page_size:Number.MAX_SAFE_INTEGER};let{list:u}=await t(e);return u}(),u=[],o={};e.forEach((e=>{if(u.includes(e.job_group)){const t={job_name:e.job_name,job_id:e.job_id};o[e.job_group].push(t)}else{u.push(e.job_group);let t=[];const a={job_name:e.job_name,job_id:e.job_id};t.push(a),o[e.job_group]=t}})),S.value=o,T.value=S.value[U.value.job_group]}(),(e,t)=>{const u=Vue.resolveComponent("el-option"),o=Vue.resolveComponent("el-select"),_=Vue.resolveComponent("el-form-item"),w=Vue.resolveComponent("el-date-picker"),C=Vue.resolveComponent("el-button"),y=Vue.resolveComponent("el-form"),D=Vue.resolveComponent("el-col"),S=Vue.resolveComponent("el-checkbox"),E=Vue.resolveComponent("right-toolbar"),O=Vue.resolveComponent("el-row"),G=Vue.resolveComponent("el-table-column"),J=Vue.resolveComponent("dict-tag"),Q=Vue.resolveComponent("el-table"),X=Vue.resolveComponent("pagination"),H=Vue.resolveComponent("el-tooltip"),K=Vue.resolveComponent("el-dialog"),W=Vue.resolveDirective("hasPermi"),Z=Vue.resolveDirective("loading");return Vue.openBlock(),Vue.createElementBlock("div",a,[Vue.withDirectives(Vue.createVNode(y,{model:Vue.unref(U),ref:"queryRef",inline:!0,"label-width":"68px"},{default:Vue.withCtx((()=>[Vue.createVNode(_,{label:"任务组名",prop:"job_group"},{default:Vue.withCtx((()=>[Vue.createVNode(o,{modelValue:Vue.unref(U).job_group,"onUpdate:modelValue":t[0]||(t[0]=e=>Vue.unref(U).job_group=e),placeholder:"请任务组名",clearable:"",style:{width:"240px"},onChange:M},{default:Vue.withCtx((()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(m),(e=>(Vue.openBlock(),Vue.createBlock(u,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),Vue.createVNode(_,{label:"任务名称",prop:"job_name"},{default:Vue.withCtx((()=>[Vue.createVNode(o,{modelValue:Vue.unref(U).job_name,"onUpdate:modelValue":t[1]||(t[1]=e=>Vue.unref(U).job_name=e),placeholder:"请输入任务名称",clearable:"",style:{width:"240px"},onChange:L},{default:Vue.withCtx((()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(T.value,(e=>(Vue.openBlock(),Vue.createBlock(u,{key:e.job_id,label:e.job_name,value:e.job_name},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),Vue.createVNode(_,{label:"执行状态",prop:"status"},{default:Vue.withCtx((()=>[Vue.createVNode(o,{modelValue:Vue.unref(U).status,"onUpdate:modelValue":t[2]||(t[2]=e=>Vue.unref(U).status=e),placeholder:"请选择执行状态",clearable:"",style:{width:"240px"}},{default:Vue.withCtx((()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(f),(e=>(Vue.openBlock(),Vue.createBlock(u,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),Vue.createVNode(_,{label:"任务属性",prop:"is_once"},{default:Vue.withCtx((()=>[Vue.createVNode(o,{modelValue:Vue.unref(U).is_once,"onUpdate:modelValue":t[3]||(t[3]=e=>Vue.unref(U).is_once=e),placeholder:"请选择任务属性",clearable:"",style:{width:"240px"}},{default:Vue.withCtx((()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(v),(e=>(Vue.openBlock(),Vue.createBlock(u,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),Vue.createVNode(_,{label:"执行时间"},{default:Vue.withCtx((()=>[Vue.createVNode(w,{modelValue:k.value,"onUpdate:modelValue":t[4]||(t[4]=e=>k.value=e),style:{width:"240px"},"value-format":"YYYY-MM-DD",type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])])),_:1}),Vue.createVNode(_,null,{default:Vue.withCtx((()=>[Vue.createVNode(C,{type:"primary",icon:"Search",onClick:q},{default:Vue.withCtx((()=>[l])),_:1}),Vue.createVNode(C,{icon:"Refresh",onClick:F},{default:Vue.withCtx((()=>[n])),_:1})])),_:1})])),_:1},8,["model"]),[[Vue.vShow,x.value]]),Vue.createVNode(O,{gutter:10,class:"mb8",style:{height:"35px"}},{default:Vue.withCtx((()=>[Vue.createVNode(D,{span:1.5},{default:Vue.withCtx((()=>[Vue.withDirectives((Vue.openBlock(),Vue.createBlock(C,{type:"danger",plain:"",icon:"Delete",disabled:N.value,onClick:P},{default:Vue.withCtx((()=>[V])),_:1},8,["disabled"])),[[W,["system/job_log/delete"]]])])),_:1},8,["span"]),Vue.createVNode(D,{span:1.5},{default:Vue.withCtx((()=>[Vue.withDirectives((Vue.openBlock(),Vue.createBlock(C,{type:"danger",plain:"",icon:"Delete",onClick:Y},{default:Vue.withCtx((()=>[r])),_:1})),[[W,["system/job_log/clean"]]])])),_:1},8,["span"]),Vue.createVNode(D,{span:1.5},{default:Vue.withCtx((()=>[Vue.withDirectives((Vue.openBlock(),Vue.createBlock(C,{type:"warning",plain:"",icon:"Download",onClick:A},{default:Vue.withCtx((()=>[i])),_:1})),[[W,["system/job_log/export"]]])])),_:1},8,["span"]),Vue.createVNode(D,{span:1.5},{default:Vue.withCtx((()=>[Vue.createVNode(C,{type:"warning",plain:"",icon:"Close",onClick:$},{default:Vue.withCtx((()=>[d])),_:1})])),_:1},8,["span"]),Vue.createVNode(D,{span:1.5},{default:Vue.withCtx((()=>[Vue.createVNode(S,{border:"",modelValue:B.value,"onUpdate:modelValue":t[5]||(t[5]=e=>B.value=e),label:"自动刷新",onChange:z},null,8,["modelValue"])])),_:1},8,["span"]),Vue.createVNode(E,{showSearch:x.value,"onUpdate:showSearch":t[6]||(t[6]=e=>x.value=e),onQueryTable:L},null,8,["showSearch"])])),_:1}),Vue.withDirectives((Vue.openBlock(),Vue.createBlock(Q,{data:h.value,onSelectionChange:I},{default:Vue.withCtx((()=>[Vue.createVNode(G,{type:"selection",width:"55",align:"center"}),Vue.createVNode(G,{label:"日志编号",width:"80",align:"center",prop:"job_log_id","show-overflow-tooltip":""}),Vue.createVNode(G,{label:"任务名称",align:"center",prop:"job_name","show-overflow-tooltip":!0}),Vue.createVNode(G,{label:"任务组名",align:"center",prop:"job_group","show-overflow-tooltip":!0},{default:Vue.withCtx((e=>[Vue.createVNode(J,{options:Vue.unref(m),value:e.row.job_group},null,8,["options","value"])])),_:1}),Vue.createVNode(G,{label:"批ID",align:"center",prop:"lot_id","show-overflow-tooltip":!0}),Vue.createVNode(G,{label:"批内序",align:"center",prop:"lot_order","show-overflow-tooltip":!0}),Vue.createVNode(G,{label:"调用目标字符串",align:"center",prop:"invoke_target","show-overflow-tooltip":!0}),Vue.createVNode(G,{label:"日志信息",align:"center",prop:"job_message","show-overflow-tooltip":!0}),Vue.createVNode(G,{label:"执行状态",align:"center",prop:"status"},{default:Vue.withCtx((e=>[Vue.createVNode(J,{options:Vue.unref(f),value:e.row.status},null,8,["options","value"])])),_:1}),Vue.createVNode(G,{label:"任务属性",align:"center",prop:"is_once"},{default:Vue.withCtx((e=>[Vue.createVNode(J,{options:Vue.unref(v),value:e.row.is_once},null,8,["options","value"])])),_:1}),Vue.createVNode(G,{label:"执行时间",align:"center",prop:"created_at",width:"180"},{default:Vue.withCtx((t=>[Vue.createElementVNode("span",null,Vue.toDisplayString(e.parseTime(t.row.created_at)),1)])),_:1}),Vue.createVNode(G,{label:"操作",align:"center","class-name":"small-padding fixed-width"},{default:Vue.withCtx((e=>[Vue.withDirectives((Vue.openBlock(),Vue.createBlock(C,{type:"text",icon:"View",onClick:t=>{return u=e.row,b.value=!0,void(R.value=u);var u}},{default:Vue.withCtx((()=>[c])),_:2},1032,["onClick"])),[[W,["monitor:job:query"]]])])),_:1})])),_:1},8,["data"])),[[Z,g.value]]),Vue.withDirectives(Vue.createVNode(X,{total:j.value,page:Vue.unref(U).page_num,"onUpdate:page":t[7]||(t[7]=e=>Vue.unref(U).page_num=e),limit:Vue.unref(U).page_size,"onUpdate:limit":t[8]||(t[8]=e=>Vue.unref(U).page_size=e),onPagination:L},null,8,["total","page","limit"]),[[Vue.vShow,j.value>0]]),Vue.createCommentVNode(" 调度日志详细 "),Vue.createVNode(K,{title:"调度日志详细",modelValue:b.value,"onUpdate:modelValue":t[10]||(t[10]=e=>b.value=e),width:"700px","append-to-body":""},{footer:Vue.withCtx((()=>[Vue.createElementVNode("div",s,[Vue.createVNode(C,{onClick:t[9]||(t[9]=e=>b.value=!1)},{default:Vue.withCtx((()=>[p])),_:1})])])),default:Vue.withCtx((()=>[Vue.createVNode(y,{model:Vue.unref(R),"label-width":"100px"},{default:Vue.withCtx((()=>[Vue.createVNode(O,null,{default:Vue.withCtx((()=>[Vue.createVNode(D,{span:12},{default:Vue.withCtx((()=>[Vue.createVNode(_,{label:"日志序号："},{default:Vue.withCtx((()=>[Vue.createVNode(H,{class:"box-item",effect:"dark",content:Vue.unref(R).job_log_id,placement:"top-start"},{default:Vue.withCtx((()=>[Vue.createElementVNode("span",null,Vue.toDisplayString(Vue.unref(R).job_log_id.slice(0,10)+" ..."),1)])),_:1},8,["content"])])),_:1})])),_:1}),Vue.createVNode(D,{span:12},{default:Vue.withCtx((()=>[Vue.createVNode(_,{label:"任务分组："},{default:Vue.withCtx((()=>[Vue.createVNode(J,{options:Vue.unref(m),value:Vue.unref(R).job_group},null,8,["options","value"])])),_:1})])),_:1}),Vue.createVNode(D,{span:12},{default:Vue.withCtx((()=>[Vue.createVNode(_,{label:"任务名称："},{default:Vue.withCtx((()=>[Vue.createTextVNode(Vue.toDisplayString(Vue.unref(R).job_name),1)])),_:1})])),_:1}),Vue.createVNode(D,{span:12},{default:Vue.withCtx((()=>[Vue.createVNode(_,{label:"执行时间："},{default:Vue.withCtx((()=>[Vue.createTextVNode(Vue.toDisplayString(Vue.unref(R).created_at),1)])),_:1})])),_:1}),Vue.createVNode(D,{span:12},{default:Vue.withCtx((()=>[Vue.createVNode(_,{label:"执行状态："},{default:Vue.withCtx((()=>[Vue.createVNode(J,{options:Vue.unref(f),value:Vue.unref(R).status},null,8,["options","value"])])),_:1})])),_:1}),Vue.createVNode(D,{span:12},{default:Vue.withCtx((()=>[Vue.createVNode(_,{label:"任务属性："},{default:Vue.withCtx((()=>[Vue.createVNode(J,{options:Vue.unref(v),value:Vue.unref(R).is_once},null,8,["options","value"])])),_:1})])),_:1}),Vue.createVNode(D,{span:12},{default:Vue.withCtx((()=>[Vue.createVNode(_,{label:"调用方法："},{default:Vue.withCtx((()=>[Vue.createTextVNode(Vue.toDisplayString(Vue.unref(R).invoke_target),1)])),_:1})])),_:1}),Vue.createVNode(D,{span:12},{default:Vue.withCtx((()=>[Vue.createVNode(_,{label:"消耗时间："},{default:Vue.withCtx((()=>[Vue.createTextVNode(Vue.toDisplayString(Vue.unref(R).elapsed_time+" ms"),1)])),_:1})])),_:1}),Vue.createVNode(D,{span:24},{default:Vue.withCtx((()=>[Vue.createVNode(_,{label:"调用参数："},{default:Vue.withCtx((()=>[Vue.createTextVNode(Vue.toDisplayString(Vue.unref(R).job_params),1)])),_:1})])),_:1}),Vue.createVNode(D,{span:24},{default:Vue.withCtx((()=>[Vue.createVNode(_,{label:"日志信息："},{default:Vue.withCtx((()=>[Vue.createTextVNode(Vue.toDisplayString(Vue.unref(R).job_message),1)])),_:1})])),_:1}),Vue.createVNode(D,{span:24},{default:Vue.withCtx((()=>[1==Vue.unref(R).status?(Vue.openBlock(),Vue.createBlock(_,{key:0,label:"异常信息："},{default:Vue.withCtx((()=>[Vue.createTextVNode(Vue.toDisplayString(Vue.unref(R).exception_info),1)])),_:1})):Vue.createCommentVNode("v-if",!0)])),_:1})])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"])])}}}),[["__file","E:/LingDu/rust/poem/RuoYi-Vue3/src/views/monitor/job/log.vue"]]);export{f as default};
